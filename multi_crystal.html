
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Processing multi-crystal datasets with xia2 &mdash; xia2  documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/xia2.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/dials_icon.png"/>
    <link rel="top" title="xia2  documentation" href="index.html" />
    <link rel="next" title="Program output" href="program_output.html" />
    <link rel="prev" title="Insulin tutorial" href="insulin_tutorial.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
<!--   <div class="logoheader container"> -->
<!--   <a href="index.html"> -->
<!--   <img class="logoheader" alt="DIALS" src="_static/dials_header.png" /> -->
<!--   </a> -->
<!--   </div> -->
  

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="program_output.html" title="Program output"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="insulin_tutorial.html" title="Insulin tutorial"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">xia2  documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="processing-multi-crystal-datasets-with-xia2">
<h1>Processing multi-crystal datasets with xia2<a class="headerlink" href="#processing-multi-crystal-datasets-with-xia2" title="Permalink to this headline">¶</a></h1>
<p>xia2 is ideally suited to processing multi-crystal (or multi-sweep) datasets,
and is able to process more than one dataset simultaneously, providing many
features that can make the processing of such datasets both easier and faster.
Examples include (but not limited to):</p>
<ul class="simple">
<li>Merging multiple datasets taken from multiple crystals</li>
<li>Merging multiple datasets taken from a single crystal</li>
<li>Scaling together, but merging individually multiple wavelength datasets</li>
<li>Inverse beam experiments</li>
</ul>
<p>Images or directories can be passed on the command line, as with a normal
xia2 job processing a single sweep. We have recently modified xia2 to allow
passing multiple directories on the command line (previously all images
were required to be in the same directories, or nested in subdirectories),
and to allow passing multiple images via the <tt class="samp docutils literal"><span class="pre">image=</span></tt> parameter:</p>
<div class="highlight-python"><div class="highlight"><pre>xia2 -dials /path/to/images/dataset_1 /path/to/images/dataset_2

xia2 -dials image=/path/to/images/sweep_1_0001.cbf image=/path/to/images/sweep_2_0001.cbf
</pre></div>
</div>
<p>Alternatively, you can specify exactly which images you wish to process in an
.xinfo file:</p>
<div class="highlight-python"><div class="highlight"><pre>BEGIN PROJECT AUTOMATIC
BEGIN CRYSTAL DEFAULT

BEGIN WAVELENGTH NATIVE
WAVELENGTH 0.979500
END WAVELENGTH NATIVE

BEGIN SWEEP SWEEP1
WAVELENGTH NATIVE
DIRECTORY /path/to/images/
IMAGE sweep_1_0001.cbf
START_END 1 450
END SWEEP SWEEP1

BEGIN SWEEP SWEEP2
WAVELENGTH NATIVE
DIRECTORY /path/to/images/
IMAGE sweep_2_0001.cbf
START_END 1 450
END SWEEP SWEEP2

END CRYSTAL DEFAULT
END PROJECT AUTOMATIC
</pre></div>
</div>
<p>When processing many datasets simultaneously, it may happen that some datasets
will process successfully, but xia2 will fail to process others. By default,
xia2 will stop with an error message if any error is encountered, however if
the <tt class="samp docutils literal"><span class="pre">-failover</span></tt> flag is passed on the command line, then xia2 will
ignore any failed sweeps and continue processing with only those sweeps that
processed successfully.</p>
<p>When xia2 is given a particularly large number of images to process, it may
take some time before it appears to start processing the data. This may be for
a couple of reasons:</p>
<ol class="arabic simple">
<li>On start up, xia2 reads all the image headers to ensure that it understands
them correctly. A speedup can be obtained with the parameter
<tt class="samp docutils literal"><span class="pre">read_all_image_headers=False</span></tt>, which tells xia2 to only read the
first image header for each set of files with a matching template, and</li>
</ol>
<blockquote>
<div>infer the rest of the sweep from the first image header.</div></blockquote>
<ol class="arabic simple">
<li>If available, xia2 will run a beam centre search on each sweep using
labelit.index. This step can be disabled using the parameter
<tt class="samp docutils literal"><span class="pre">trust_beam_centre=True</span></tt></li>
</ol>
<p>Furthermore, xia2 may not make the same conclusion as to the symmetry for each
sweep, leading it to process the final dataset in the lowest common symmetry.
Sometimes indexing for a given sweep may fail altogether, and specifying the
<tt class="samp docutils literal"><span class="pre">unit_cell=</span></tt> and <tt class="samp docutils literal"><span class="pre">space_group=</span></tt> parameters (if known) on the
command line can help in both these situations.</p>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="53%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-failover</span></tt></td>
<td>If processing fails for any sweeps,
ignore and just use those sweeps that
processed successfully</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">trust_beam_centre=True</span></tt></td>
<td>Don&#8217;t run labelit beam centre search</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">read_all_image_headers=False</span></tt></td>
<td>Skip reading all image headers - just
read the first one for each sweep</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">unit_cell=</span></tt></td>
<td>Provide a target unit cell to help
indexing</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">space_group=</span></tt></td>
<td>Provide a target space group to help
indexing</td>
</tr>
</tbody>
</table>
<div class="section" id="parallel-data-processing">
<h2>Parallel data processing<a class="headerlink" href="#parallel-data-processing" title="Permalink to this headline">¶</a></h2>
<p>By default, xia2 processes each sweep sequentially, using <tt class="samp docutils literal"><span class="pre">nproc</span></tt>
processors. When processing multiple datasets, it may be more efficient to
process the sweeps in parallel, by specifying
<tt class="samp docutils literal"><span class="pre">multiprocessing.mode=parallel</span></tt> and
using <tt class="samp docutils literal"><span class="pre">multiprocessing.njob</span></tt> to indicate how many sweeps should be
processed simultaneously, using <tt class="samp docutils literal"><span class="pre">multiprocessing.nproc</span></tt> processors
per sweep:</p>
<div class="highlight-python"><div class="highlight"><pre>xia2 -dials /path/to/images multiprocessing.mode=parallel \
  multiprocessing.njob=2 multiprocessing.nproc=4
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This will use a total of <tt class="samp docutils literal"><span class="pre">njob</span></tt> <img class="math" src="_images/math/0b8f66a848c851c882bd816037c9c5859ca75570.png" alt="*"/> <tt class="samp docutils literal"><span class="pre">nproc</span></tt> processors,
i.e. <img class="math" src="_images/math/ccf223ff9d3dcceff90ff69a1fe5ee9721e0c803.png" alt="2 * 4 = 8"/> processors, which should be less than or equal to the total
number of processors available on your machine.</p>
</div>
<p>Additionally, xia2 can utilise the processing power of a cluster where
available (currently we only support qsub) by specifying the parameter
<tt class="samp docutils literal"><span class="pre">multiprocessing.type=qsub</span></tt>. The parameter
<tt class="samp docutils literal"><span class="pre">multiprocessing.qsub_command</span></tt> may be used (if needed) to e.g. specify
which queue jobs should be submitted to:</p>
<div class="highlight-python"><div class="highlight"><pre>xia2 -dials /path/to/images multiprocessing.mode=parallel \
  multiprocessing.type=qsub multiprocessing.qsub_command=&quot;qsub -q low.q&quot; \
  multiprocessing.njob=10 multiprocessing.nproc=16
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">multiprocessing.mode=parallel</span></tt></td>
<td>Process multiple sweeps in parallel,
rather than serially</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">multiprocessing.njob=4</span></tt></td>
<td>In conjunction with mode=parallel,
process 4 sweeps simultaneously</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">multiprocessing.nproc=1</span></tt></td>
<td>Use 1 processor per job (sweep)</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">multiprocessing.type=qsub</span></tt></td>
<td>Submit individual processing jobs to
cluster using qsub</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">multiprocessing.type=qsub_command</span></tt></td>
<td>The command to use to submit qsub
jobs</td>
</tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/xia2-new-logo.gif" alt="Logo"/>
    
  </a>
</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_xia2.html">Using xia2</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="introductory_example.html">Introductory example</a></li>
<li class="toctree-l1"><a class="reference internal" href="insulin_tutorial.html">Insulin tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Multi-crystal data</a></li>
<li class="toctree-l1"><a class="reference internal" href="program_output.html">Program output</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="comments.html">Comments</a></li>
<li class="toctree-l1"><a class="reference internal" href="background.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer container">
  <a href="http://www.diamond.ac.uk/"><img class="logofooter" alt="Diamond" src="_static/diamond_logo.png" /></a>
  <a href="http://dials.diamond.ac.uk/"><img class="logofooter" alt="DIALS" src="_static/dials_logo_fx_transparent_bg.png" /></a>
  <a href="http://www.ccp4.ac.uk/"><img class="logofooter" alt="CCP4" src="_static/CCP4-logo-plain.png" /></a>
  </div>
  
    <div class="footer">
      &copy;2015, Diamond Light Source.
      
    </div>

    

    

  </body>
</html>