

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>xia2 multi-crystal tutorial &#8212; xia2  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/xia2.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/dials_icon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
<!--   <div class="logoheader container"> -->
<!--   <a href="../index.html"> -->
<!--   <img class="logoheader" alt="DIALS" src="../_static/dials_header.png" /> -->
<!--   </a> -->
<!--   </div> -->
  

  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="xia2-multi-crystal-tutorial">
<h1>xia2 multi-crystal tutorial<a class="headerlink" href="#xia2-multi-crystal-tutorial" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial we are going to process several 5° wedges of thermolysin
data, taken from multiple crystals, first using xia2 to process the images
using the XDS pipeline, and then use <a class="reference external" href="http://www.ccp4.ac.uk/html/blend.html">BLEND</a> on the resulting processed
reflection files to analyse the datasets for non-isomorphism.</p>
<p>First we need to type several commands in order to make available all the
software we need for the tutorial:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># make XDS available</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">XDS</span>

<span class="c1"># get the latest version of CCP4</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">ccp4</span>

<span class="c1"># get latest combined DIALS/xia2</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">dials</span><span class="o">/</span><span class="n">dev</span><span class="o">-</span><span class="mi">228</span>

<span class="c1"># needed by BLEND</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">R</span>
</pre></div>
</div>
<p>Next we have the xia2 command to run. Below we explain in detail the meaning
of each parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xia2</span> <span class="o">-</span><span class="mi">3</span><span class="n">dii</span> <span class="o">-</span><span class="n">failover</span> \
  <span class="n">mode</span><span class="o">=</span><span class="n">parallel</span> <span class="n">njob</span><span class="o">=</span><span class="mi">4</span> <span class="n">nproc</span><span class="o">=</span><span class="mi">1</span> \
  <span class="n">trust_beam_centre</span><span class="o">=</span><span class="kc">True</span> <span class="n">read_all_image_headers</span><span class="o">=</span><span class="kc">False</span> \
  <span class="n">unit_cell</span><span class="o">=</span><span class="s2">&quot;92.73  92.73 128.13  90.00  90.00 120.00&quot;</span> \
  <span class="n">space_group</span><span class="o">=</span><span class="n">P6122</span> <span class="o">-</span><span class="n">atom</span> <span class="n">X</span> \
  <span class="o">/</span><span class="n">dls</span><span class="o">/</span><span class="n">mx</span><span class="o">-</span><span class="n">scratch</span><span class="o">/</span><span class="n">mx_bag_training</span><span class="o">/</span><span class="n">thermolysin</span><span class="o">/</span>
</pre></div>
</div>
<p>This command will run all the processing on a single computer. Assuming the
computer has 4 processors available, we have set <code class="docutils literal notranslate"><span class="pre">njob=4</span></code>. If the computer we
are using has more processors available, we may increase either <code class="docutils literal notranslate"><span class="pre">njob</span></code> or
<code class="docutils literal notranslate"><span class="pre">nproc</span></code>, whilst ensuring that <code class="docutils literal notranslate"><span class="pre">nproc</span> <span class="pre">x</span> <span class="pre">njob</span></code> is less than or equal to the
total number of processors available. Alternatively,
we can take advantage of the cluster to process our data more quickly, by
using the xia2 parameter <code class="docutils literal notranslate"><span class="pre">type=qsub</span></code>, which tells xia2 to submit individual
jobs to the cluster using the <code class="docutils literal notranslate"><span class="pre">qsub</span></code> command. Since we are using the cluster,
and not a single computer, we can increase the <code class="docutils literal notranslate"><span class="pre">nproc</span></code> parameter, e.g. to
<code class="docutils literal notranslate"><span class="pre">nproc=12</span></code> which will now use 12 processors per sweep. We can also increase
<code class="docutils literal notranslate"><span class="pre">njob=20</span></code> to process all 20 sweeps simultaneously. We also need to add an
extra <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">global/cluster</span></code> command to make the cluster available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="k">global</span><span class="o">/</span><span class="n">cluster</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">XDS</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">ccp4</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">dials</span><span class="o">/</span><span class="n">dev</span><span class="o">-</span><span class="mi">228</span>

<span class="n">xia2</span> <span class="o">-</span><span class="mi">3</span><span class="n">dii</span> <span class="o">-</span><span class="n">failover</span> \
  <span class="n">mode</span><span class="o">=</span><span class="n">parallel</span> <span class="n">njob</span><span class="o">=</span><span class="mi">20</span> <span class="n">nproc</span><span class="o">=</span><span class="mi">12</span> <span class="nb">type</span><span class="o">=</span><span class="n">qsub</span>\
  <span class="n">trust_beam_centre</span><span class="o">=</span><span class="kc">True</span> <span class="n">read_all_image_headers</span><span class="o">=</span><span class="kc">False</span> \
  <span class="n">unit_cell</span><span class="o">=</span><span class="s2">&quot;92.73  92.73 128.13  90.00  90.00 120.00&quot;</span> \
  <span class="n">space_group</span><span class="o">=</span><span class="n">P6122</span> <span class="o">-</span><span class="n">atom</span> <span class="n">X</span> \
  <span class="o">/</span><span class="n">dls</span><span class="o">/</span><span class="n">mx</span><span class="o">-</span><span class="n">scratch</span><span class="o">/</span><span class="n">mx_bag_training</span><span class="o">/</span><span class="n">thermolysin</span><span class="o">/</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">-3dii</span></code></td>
<td>Use the 3D (XDS) pipeline, using all
images in indexing</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">-failover</span></code></td>
<td>If processing fails for any sweeps,
ignore and just use those sweeps that
processed successfully</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">mode=parallel</span></code></td>
<td>Process multiple sweeps in parallel,
rather than serially</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">njob=4</span></code></td>
<td>In conjunction with mode=parallel,
process 4 sweeps simultaneously</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">nproc=1</span></code></td>
<td>Use 1 processor per job (sweep)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">type=qsub</span></code></td>
<td>Submit individual processing jobs to
cluster using qsub</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">trust_beam_centre=True</span></code></td>
<td>Don’t run labelit beam centre search</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">read_all_image_headers=False</span></code></td>
<td>Skip reading all image headers - just
read the first one for each sweep</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">unit_cell=</span></code></td>
<td>Provide a target unit cell to help
indexing</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">space_group=</span></code></td>
<td>Provide a target space group to help
indexing</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">-atom</span> <span class="pre">X</span></code></td>
<td>Anomalous flag: don’t merge Friedel pairs</td>
</tr>
</tbody>
</table>
<p>Once xia2 has finished processing all the data, the final merging statistics
reported by xia2 are as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">For</span> <span class="n">AUTOMATIC</span><span class="o">/</span><span class="n">DEFAULT</span><span class="o">/</span><span class="n">SAD</span>
<span class="n">High</span> <span class="n">resolution</span> <span class="n">limit</span>                    <span class="mf">1.29</span>    <span class="mf">5.63</span>    <span class="mf">1.29</span>
<span class="n">Low</span> <span class="n">resolution</span> <span class="n">limit</span>                    <span class="mf">68.02</span>   <span class="mf">68.02</span>    <span class="mf">1.33</span>
<span class="n">Completeness</span>                            <span class="mf">67.2</span>    <span class="mf">99.6</span>     <span class="mf">2.8</span>
<span class="n">Multiplicity</span>                             <span class="mf">6.5</span>     <span class="mf">9.2</span>     <span class="mf">1.1</span>
<span class="n">I</span><span class="o">/</span><span class="n">sigma</span>                                 <span class="mf">16.1</span>    <span class="mf">27.6</span>     <span class="mf">4.3</span>
<span class="n">Rmerge</span>                                 <span class="mf">0.124</span>   <span class="mf">0.136</span>   <span class="mf">0.000</span>
<span class="n">Rmeas</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>                               <span class="mf">0.144</span>   <span class="mf">0.162</span>   <span class="mf">0.608</span>
<span class="n">Rmeas</span><span class="p">(</span><span class="n">I</span><span class="o">+/-</span><span class="p">)</span>                            <span class="mf">0.138</span>   <span class="mf">0.149</span>   <span class="mf">0.000</span>
<span class="n">Rpim</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>                                <span class="mf">0.047</span>   <span class="mf">0.052</span>   <span class="mf">0.430</span>
<span class="n">Rpim</span><span class="p">(</span><span class="n">I</span><span class="o">+/-</span><span class="p">)</span>                             <span class="mf">0.058</span>   <span class="mf">0.060</span>   <span class="mf">0.000</span>
<span class="n">CC</span> <span class="n">half</span>                                <span class="mf">0.988</span>   <span class="mf">0.956</span>   <span class="mf">0.823</span>
<span class="n">Wilson</span> <span class="n">B</span> <span class="n">factor</span>                        <span class="mf">18.807</span>
<span class="n">Anomalous</span> <span class="n">completeness</span>                  <span class="mf">53.6</span>    <span class="mf">97.9</span>     <span class="mf">0.2</span>
<span class="n">Anomalous</span> <span class="n">multiplicity</span>                   <span class="mf">2.8</span>     <span class="mf">4.9</span>     <span class="mf">1.0</span>
<span class="n">Anomalous</span> <span class="n">correlation</span>                   <span class="mf">0.208</span>   <span class="mf">0.328</span>   <span class="mf">0.000</span>
<span class="n">Anomalous</span> <span class="n">slope</span>                        <span class="mf">1.303</span>   <span class="mf">0.000</span>   <span class="mf">0.000</span>
<span class="n">dF</span><span class="o">/</span><span class="n">F</span>                                   <span class="mf">0.076</span>
<span class="n">dI</span><span class="o">/</span><span class="n">s</span><span class="p">(</span><span class="n">dI</span><span class="p">)</span>                               <span class="mf">1.056</span>
<span class="n">Total</span> <span class="n">observations</span>                     <span class="mi">356049</span>  <span class="mi">10633</span>   <span class="mi">187</span>
<span class="n">Total</span> <span class="n">unique</span>                           <span class="mi">55180</span>   <span class="mi">1161</span>    <span class="mi">176</span>
<span class="n">Assuming</span> <span class="n">spacegroup</span><span class="p">:</span> <span class="n">P</span> <span class="mi">61</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="n">Unit</span> <span class="n">cell</span><span class="p">:</span>
<span class="mf">92.620</span>  <span class="mf">92.620</span> <span class="mf">128.330</span>
<span class="mf">90.000</span>  <span class="mf">90.000</span> <span class="mf">120.000</span>
</pre></div>
</div>
<p>These merging statistics are for all the data from all 20 sweeps
merged together. Depending upon the quality of the particular datasets, and
what exactly we want to do with the processed data in the next step, this may
well be good enough, however in some cases we may want to analyse the
individual datasets for non-isomorphism using <a class="reference external" href="http://www.ccp4.ac.uk/html/blend.html">BLEND</a> with the hope of finding
a subset of the data that gives a better quality merged dataset than merging
the all of the data together. We can run <a class="reference external" href="http://www.ccp4.ac.uk/html/blend.html">BLEND</a> in <em>analysis</em> mode on the
integrated reflection files output by XDS as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>find `pwd` -name &quot;INTEGRATE.HKL&quot; &gt; data.txt
blend –a data.txt
</pre></div>
</div>
<p>Because we are not running with keywords, press enter while it’s running then
check the resulting dendrogram:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">display</span> <span class="n">tree</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<img alt="../_images/thermolysin_blend_tree.png" src="../_images/thermolysin_blend_tree.png" />
<p>If we wish we can now run <a class="reference external" href="http://www.ccp4.ac.uk/html/blend.html">BLEND</a> in <em>synthesis</em> or <em>combination</em> mode to
scale together and merge subsets of the data, for example to get the merged
dataset for the second highest node in the dendrogram:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">blend</span> <span class="o">-</span><span class="n">s</span> <span class="mi">10</span> <span class="mi">5</span>
</pre></div>
</div>
<p>pressing enter several times as before. This gives the resulting merging
statistics as reported by <a class="reference external" href="http://www.ccp4.ac.uk/html/blend.html">BLEND</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*********</span> <span class="n">Cluster</span> <span class="mi">18</span><span class="p">,</span> <span class="n">composed</span> <span class="n">of</span> <span class="n">datasets</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">11</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">15</span> <span class="mi">16</span> <span class="mi">18</span> <span class="mi">19</span> <span class="mi">20</span> <span class="o">*********</span>
<span class="n">Collating</span> <span class="n">multiple</span> <span class="n">mtz</span> <span class="n">into</span> <span class="n">a</span> <span class="n">single</span> <span class="n">mtz</span> <span class="o">...</span>
<span class="n">Running</span> <span class="n">AIMLESS</span> <span class="n">on</span> <span class="n">the</span> <span class="n">unscaled</span> <span class="n">file</span> <span class="o">...</span>
 <span class="n">Statistics</span> <span class="k">for</span> <span class="n">this</span> <span class="n">group</span><span class="p">:</span>
           <span class="n">Rmeas</span>  <span class="n">Rpim</span> <span class="n">Completeness</span> <span class="n">Multiplicity</span> <span class="n">LowRes</span> <span class="n">HighRes</span>
<span class="n">Overall</span>    <span class="mf">0.133</span> <span class="mf">0.074</span>         <span class="mf">86.4</span>          <span class="mf">2.6</span>  <span class="mf">50.15</span>    <span class="mf">2.48</span>
<span class="n">InnerShell</span> <span class="mf">0.175</span> <span class="mf">0.096</span>         <span class="mf">85.2</span>          <span class="mf">2.7</span>  <span class="mf">50.15</span>    <span class="mf">8.93</span>
<span class="n">OuterShell</span> <span class="mf">0.171</span> <span class="mf">0.096</span>         <span class="mf">87.9</span>          <span class="mf">2.6</span>   <span class="mf">2.58</span>    <span class="mf">2.48</span>
</pre></div>
</div>
<p>For more information on using <a class="reference external" href="http://www.ccp4.ac.uk/html/blend.html">BLEND</a> see the <a class="reference external" href="http://www.ccp4.ac.uk/tutorials/tutorial_files/blend_tutorial/BLEND_tutorial.html">BLEND tutorials</a>.</p>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/xia2-new-logo.gif" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_xia2.html">Using xia2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introductory_example.html">Introductory example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../insulin_tutorial.html">Insulin tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../multi_crystal.html">Multi-crystal data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../program_output.html">Program output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameters.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../comments.html">Comments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer container">
  <a href="http://www.diamond.ac.uk/"><img class="logofooter" alt="Diamond" src="../_static/diamond_logo.png" /></a>
  <a href="http://dials.diamond.ac.uk/"><img class="logofooter" alt="DIALS" src="../_static/dials_logo_fx_transparent_bg.png" /></a>
  <a href="http://www.ccp4.ac.uk/"><img class="logofooter" alt="CCP4" src="../_static/CCP4-logo-plain.png" /></a>
  </div>
  
    <div class="footer">
      &copy;2015, Diamond Light Source.
      
    </div>

    

    

  </body>
</html>